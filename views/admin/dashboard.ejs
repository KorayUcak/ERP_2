<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yönetici Paneli - Simya ERP</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/enterprise-style.css">
</head>
<body>
  <nav class="navbar">
    <div class="navbar-header">
      <h1>Simya ERP - Yönetici Paneli</h1>
      <div class="navbar-right">
        <span class="user-info">Hoş geldiniz, <%= username %></span>
        <a href="/logout" class="logout-btn">Çıkış Yap</a>
      </div>
    </div>
    <div class="navbar-menu">
      <a href="/admin" class="active">Ana Sayfa</a>
      <a href="/admin/stok-yenile">Stok Yenile</a>
      <a href="/admin/raporlar">Raporlar</a>
      <a href="/admin/operator-sureleri">Operatör Süreleri</a>
      <a href="/admin/kimyasal-tuketim">Kimyasal Tüketim</a>
      <a href="/admin/bildirimler">Personel Bildirimleri</a>
      <a href="/admin/sevkiyat-tamamlananlar">Sevkiyatı Tamamlananlar</a>
    </div>
  </nav>
  
  <div class="container">
    <% if (success) { %>
      <div class="alert-success">
        <%= success %>
      </div>
    <% } %>
    
    <% if (error) { %>
      <div class="alert-error">
        <%= error %>
      </div>
    <% } %>
    
    <div class="stats-grid">
      <div class="stat-card" style="border-left: 4px solid var(--primary-500);">
        <h3>Toplam Sipariş</h3>
        <p style="color: var(--primary-500);"><%= stats.toplam_siparis || 0 %></p>
      </div>
      
      <div class="stat-card" style="border-left: 4px solid #8B5CF6;">
        <h3>Aktif Sipariş</h3>
        <p style="color: #8B5CF6;"><%= stats.aktif_siparis || 0 %></p>
      </div>
      
      <div class="stat-card" style="border-left: 4px solid #06B6D4;">
        <h3>Bugün Termin</h3>
        <p style="color: #06B6D4;"><%= stats.bugun_termin || 0 %></p>
      </div>
      
      <div class="stat-card" style="border-left: 4px solid var(--warning-500);">
        <h3>Geciken Sipariş</h3>
        <p style="color: var(--warning-500);"><%= stats.geciken || 0 %></p>
      </div>
      
      <div class="stat-card" style="border-left: 4px solid #6366F1;">
        <h3>Toplam Operatör</h3>
        <p style="color: #6366F1;"><%= stats.toplam_operator || 0 %></p>
      </div>
      
      <div class="stat-card" style="border-left: 4px solid var(--accent-500);">
        <h3>Aktif İşlem</h3>
        <p style="color: var(--accent-500);"><%= stats.aktif_islem || 0 %></p>
      </div>
      
      <div class="stat-card" style="border-left: 4px solid var(--error-500);">
        <h3>Asgari Stok Altı</h3>
        <p style="color: var(--error-500);"><%= stats.asgari_stok_alti || 0 %></p>
      </div>
    </div>
    
    <% if (stokUyari.length > 0) { %>
      <div class="content-card">
        <h2 style="color: var(--error-600);">⚠️ Stok Uyarısı</h2>
        <table>
          <thead>
            <tr>
              <th>Kimyasal Adı</th>
              <th>Mevcut Miktar</th>
              <th>Asgari Seviye</th>
              <th>Eksik Miktar</th>
            </tr>
          </thead>
          <tbody>
            <% stokUyari.forEach(stok => { %>
              <tr>
                <td><%= stok.kimyasal_adi %></td>
                <td style="color: var(--error-600); font-weight: 600;"><%= stok.mevcut_miktar %></td>
                <td><%= stok.asgari_seviye %></td>
                <td style="color: var(--error-600); font-weight: 600;"><%= stok.eksik_miktar %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
    
    <div class="content-card">
      <h2>Öncelikli Siparişler (Termin Tarihine Göre)</h2>
      <table>
        <thead>
          <tr>
            <th>Sipariş ID</th>
            <th>Müşteri</th>
            <th>Ürün</th>
            <th>Durum</th>
            <th>Termin Tarihi</th>
            <th>Kalan Gün</th>
            <th>İşlem</th>
          </tr>
        </thead>
        <tbody>
          <% aktifSiparisler.forEach(siparis => { %>
            <tr>
              <td style="font-weight: 500;">#<%= siparis.id %></td>
              <td><%= siparis.musteri_adi %></td>
              <td><%= siparis.urun_adi %></td>
              <td><%= siparis.durum %></td>
              <td><%= new Date(siparis.teslim_tarihi).toLocaleDateString('tr-TR') %></td>
              <td style="<%= siparis.kalan_gun < 0 ? 'color: var(--error-600); font-weight: 600;' : siparis.kalan_gun <= 3 ? 'color: var(--warning-600); font-weight: 600;' : '' %>">
                <%= siparis.kalan_gun %> gün
              </td>
              <td>
                <button onclick="sevkiyatTamamla(<%= siparis.id %>)" class="btn-small" style="background: #10b981; color: white; padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500;">
                  ✓ Sevkiyatı Tamamla
                </button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    function sevkiyatTamamla(siparisDetayID) {
      if (confirm('Bu siparişin sevkiyatını onaylıyor musunuz?')) {
        fetch('/admin/sevkiyat-tamamla', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ siparisDetayID: siparisDetayID })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Sevkiyat başarıyla tamamlandı!');
            location.reload();
          } else {
            alert('Hata: ' + (data.error || 'Bir hata oluştu'));
          }
        })
        .catch(error => {
          console.error('Hata:', error);
          alert('Bir hata oluştu!');
        });
      }
    }
  </script>
</body>
</html>
